<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Top-Shelf-Shop: Product Catalog</title>
    <meta
      name="description"
      content="Top-Shelf-Shop ‚Äî premium products and flower available for delivery."
    />
    <!-- favicon / browser tab icon -->
    <link rel="icon" type="image/png" href="images/theTopShelfLogo.png" sizes="32x32" />
    <link rel="apple-touch-icon" href="images/theTopShelfLogo.png" />
    <meta name="theme-color" content="#0f1113" />
    <!-- reCAPTCHA script -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <style>
      /* ---------- Theme variables & base styles ---------- */
      :root {
        --bg: #0f1113;
        --card: #111418;
        --muted: #9aa3a8;
        --accent: #bca56a;
        --glass: rgba(255, 255, 255, 0.03);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        background: linear-gradient(180deg, #0b0c0d 0%, #0f1113 100%);
        color: #e6eef1;
        min-height: 100vh;
      }

      header {
        padding: 2rem 1rem;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      }

      header h1 {
        margin: 0;
        font-size: 2.1rem;
        letter-spacing: 0.4px;
        font-family: 'Courier New', Courier, monospace;
        display: inline-block;
        vertical-align: middle;
      }

      #siteLogo {
        display: inline-block;
        height: 40px;
        margin: 0 0.6rem 0 0;
        vertical-align: middle;
        object-fit: contain;
      }

      header p {
        margin: 0.4rem 0 0;
        color: var(--muted);
      }

      main {
        max-width: 1100px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .controls {
        display: none;
        gap: 0.5rem;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 1rem;
      }

      .controls.show {
        display: flex;
      }

      #toggleControls {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 100;
        display: none; /* hidden per user request; toggle remains in DOM */
      }

      .gallery {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        width: 100%;
        margin: 0;
        padding: 0;
      }

      .gallery img {
        width: 100%;
        height: auto;
        object-fit: contain;
        border-radius: 0;
      }

      /* Responsive: side-by-side on wide screens */
      @media (min-width: 900px) {
        .gallery {
          flex-direction: row;
          align-items: flex-start;
        }

        .gallery img {
          width: 50%;
          height: auto;
        }
      }

      .search {
        flex: 1;
        min-width: 180px;
      }

      input,
      select {
        background: var(--card);
        border: 1px solid rgba(255, 255, 255, 0.04);
        padding: 0.6rem 0.75rem;
        border-radius: 8px;
        color: inherit;
      }

      button {
        background: var(--accent);
        border: none;
        padding: 0.6rem 0.9rem;
        border-radius: 8px;
        color: #071013;
        font-weight: 600;
        cursor: pointer;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 1rem;
      }

      .grid.show {
        display: grid;
      }

      .card {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.04));
        padding: 1rem;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.03);
      }

      .thumb {
        aspect-ratio: 1 / 1;
        width: 100%;
        max-width: 230px; /* optional if you want same size as before */
        border-radius: 8px;
        overflow: hidden;
        background: var(--glass);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.75rem;
      }


      .thumb img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        display: block;
      }


      .tags {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
      }

      .pill {
        background: rgba(255, 255, 255, 0.03);
        padding: 0.25rem 0.5rem;
        border-radius: 999px;
        font-size: 0.8rem;
        color: var(--muted);
      }

      .meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 0.5rem;
      }

      .meta small {
        color: var(--muted);
      }

      .price {
        margin-top: 0.45rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .price .orig {
        color: var(--muted);
        text-decoration: line-through;
        font-size: 0.95rem;
      }

      .price .sale {
        color: var(--accent);
        font-weight: 700;
        font-size: 1rem;
      }

      footer {
        text-align: center;
        padding: 1.5rem 1rem;
        color: var(--muted);
        border-top: 1px solid rgba(255, 255, 255, 0.03);
        margin-top: 2rem;
      }

    

      /* strain modal */
      .modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.75));
        z-index: 1000;
      }

      .modal .inner {
        background: var(--card);
        padding: 1rem;
        border-radius: 10px;
        max-width: 760px;
        width: 92%;
      }

      .modal .inner h3 {
        margin: 0;
      }

      @media (max-width: 520px) {
        header h1 {
          font-size: 1.2rem;
        }
        
        /* thumbnail */
        .thumb {
          aspect-ratio: 1 / 1;
          width: 100%;
          border-radius: 8px;
          overflow: hidden;
          background: var(--glass);
          display: flex;
          align-items: center;
          justify-content: center;
        }

      }

      .modal button {
        background: var(--accent);
        border: none;
        padding: 0.5rem 0.9rem;
        border-radius: 8px;
        color: #071013;
        font-weight: 600;
        cursor: pointer;
      }

      .card button {
        display: none;
      }

      .modal {
        opacity: 0;
        transition: opacity 0.25s ease;
        pointer-events: none;
      }

      .modal.show {
        opacity: 1;
        pointer-events: auto;
      }

      .ig {
        margin-top: 0.75rem;
      }

      .ig a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.95rem;
      }

      .ig a:hover {
        text-decoration: underline;
      }

      /* reCAPTCHA overlay */
      #recaptchaOverlay {
        position: fixed;
        inset: 0;
        background: linear-gradient(180deg, rgba(4, 6, 8, 0.95), rgba(4, 6, 8, 0.98));
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      #recaptchaOverlay.hidden {
        display: none;
      }

      .recaptcha-box {
        max-width: 520px;
        background: var(--card);
        padding: 2rem;
        border-radius: 12px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.04);
      }

      .recaptcha-box h2 {
        margin: 0 0 1rem;
        font-size: 1.4rem;
      }

      .recaptcha-box p {
        color: var(--muted);
        margin: 0 0 1.5rem;
        line-height: 1.5;
      }

      .g-recaptcha {
        display: flex;
        justify-content: center;
        margin: 1.5rem 0;
      }

      /* Age verification overlay */
      #ageGate {
        position: fixed;
        inset: 0;
        background: linear-gradient(180deg, rgba(4,6,8,0.92), rgba(4,6,8,0.96));
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }

      #ageGate .box {
        background: var(--card);
        padding: 1.25rem 1.5rem;
        border-radius: 12px;
        text-align: center;
        max-width: 460px;
        width: 92%;
        border: 1px solid rgba(255,255,255,0.04);
      }

      #ageGate h2 { margin: 0 0 0.5rem; }
      #ageGate p { color: var(--muted); margin: 0 0 1rem; }
      #ageGate .deny { background: transparent; color: var(--muted); border: 1px solid rgba(255,255,255,0.04); }
      #ageGate .box button { margin: 0 0.35rem; }
      
      .dm-note {
        display: block;
        font-size: 0.75rem;
        color: var(--muted);
        margin-top: 0.25rem;
        letter-spacing: 0.3px;
      }

      .ig-popup {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.65);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 99999;
      }

      .ig-popup-inner {
        position: relative;
      }

      .ig-popup-inner img {
        width: 38vw; /* 38% of screen width */
        max-width: 420px; /* optional safety cap */
        border-radius: 12px;
        display: block; /* ensure popup image is visible when popup shown */
        max-height: 80vh;
      }

      .ig-close {
        position: absolute;
        top: -12px;
        right: -12px;
        background: #000;
        color: #fff;
        border: none;
        font-size: 1.1rem;
        padding: 4px 8px;
        border-radius: 6px;
        cursor: pointer;
      }

      /* Announcement bar */
      #announcementBar {
        background: #000000;
        color: #ffffff;
        padding: 0.2rem;
        text-align: center;
        font-size: 0.93rem;
        font-weight: 500;
        line-height: 1.4;
        width: 100%;
        box-sizing: border-box;
        max-height: 70px;
        display: block;
      }
    </style>
  </head>

  
  <body>
    <!-- Snap Popup -->
    <div id="igPopup" class="ig-popup">
      <div class="ig-popup-inner">
        <button class="ig-close">‚úï</button>
        <img src="images/quneeds2.0SnapCode.png" alt="Snapcode for quneeds2.0">
      </div>
    </div>
    <!-- Service announcement bar -->
    <div id="announcementBar">
      üì¢ Announcements: <br> Yarts should be back by tuesday + HUGE new vape stock coming in 4-5 days. -pj
    </div>

    <!-- reCAPTCHA verification overlay -->
    <div id="recaptchaOverlay">
      <div class="recaptcha-box">
        <h2>Verify Access</h2>
        <p>Complete the reCAPTCHA below to view our product catalog.</p>
        <div class="g-recaptcha" data-sitekey="6Lf1ZB4sAAAAAFanXTtPdqmtD7XAmJ3MAABTq7hY" data-callback="onRecaptchaSuccess"></div>
        <p style="font-size:0.85rem;color:var(--muted);margin-top:1rem">
          This site is protected by reCAPTCHA and the Google
          <a href="https://policies.google.com/privacy" target="_blank" style="color:var(--accent)">Privacy Policy</a> and
          <a href="https://policies.google.com/terms" target="_blank" style="color:var(--accent)">Terms of Service</a> apply.
        </p>
      </div>
    </div>

    <!-- age gate (reintroduced) -->
    <div id="ageGate" role="dialog" aria-labelledby="ageGateTitle" aria-modal="true">
      <div class="box">
        <h2 id="ageGateTitle">Age Verification</h2>
        <p>You must be 19 years of age or older to view this site. Please confirm you are 19+ to continue.</p>
        <div>
          <button id="ageYes">I am 19+</button>
          <button id="ageNo" class="deny">Exit</button>
        </div>
      </div>
    </div>

    <header>
      <img id="siteLogo" src="images/theTopShelfLogo.png" alt="Top Shelf Logo" />
      <h1>Top Shelf Shop</h1>
      <p>PRODUCT CATALOG - UPDATED EVERY THURSDAY</p>

      <div class="ig">
        <a href="https://instagram.com/quneeds2.0" target="_blank">@quneeds2.0</a>
        <small class="dm-note">DM üì≤‚ÜóÔ∏è</small>
      </div>
    </header>

    <main>
      <button id="toggleControls">Show Controls</button>

      <div class="controls">
        <input class="search" id="search" placeholder="Search strains, effects, products, or notes" />

        <select id="viewFilter">
          <option value="both">View: Both</option>
          <option value="strains">Strains</option>
          <option value="products">Products</option>
        </select>

        <select id="typeFilter">
          <option value="all">All types</option>
          <option value="indica">Indica</option>
          <option value="sativa">Sativa</option>
          <option value="hybrid">Hybrid</option>
        </select>

        <select id="thcFilter">
          <option value="any">Any THC</option>
          <option value="low">Low &lt;10%</option>
          <option value="med">10‚Äì20%</option>
          <option value="high">20%+</option>
        </select>

        <button id="reset">Reset</button>
      </div>

      <!-- gallery removed per user request -->

      <section class="grid" id="catalog">
        <!-- Cards injected by JS -->
      </section>

      <!-- Footer / legal notice -->
      <footer>
        <small>
          Top-Shelf-Shop ‚Äî showcasing products and strains. We do not sell products to persons under 19. &copy; Top-Shelf-Shop
        </small>
      </footer>

      <!-- Modal: shows details for a strain or product -->
      <div class="modal" id="modal" aria-hidden="true">
        <div class="inner">
          <h3 id="m-title">Strain name</h3>
          <p id="m-desc"></p>
          <p id="m-notes" style="color:var(--muted)"></p>
          <div style="text-align:right;margin-top:.75rem">
            <button id="closeModal">Close</button>
          </div>
        </div>
      </div>

    <script>
      // ---------- Data: strains & products ----------
      // Sample strain data ‚Äî replace/extend as you like
      const strains = [
        {
          id: 1,
          name: 'Grease Monkey Cannabis ‚Äì Premium Hybrid',
          image: 'greaseMonkey.png',
          type: 'hybrid',
          thc: '26%-28%',
          cbd: 0.1,
          flavour: 'Berry, Sweet',
          effects: 'Relaxed, Happy',
          desc: 'Grease Monkey is a high-end indica-dominant hybrid offering a vanilla-sweet flavor with a diesel finish and a deeply relaxing, body-melting experience.',
          price: 25.00
        },
        {
          id: 2,
          name: '5% nic OVNS Mesh10 ‚Äì 3,000 Puff Disposable Vape',
          image: 'ovnsMesh10s.png',
          type: 'hybrid',
          thc: '26%-28%',
          cbd: 0.1,
          flavour: 'Berry, Sweet',
          effects: 'Relaxed, Happy',
          desc: `Puffs: Up to 3,000 <br>Capacity: 10mL <br>Battery: 1200mAh <br><br>Available Flavours:<br>
          - Baby Bear<br>
          - Mixed Berry<br>
          - Peach Ice<br>
          - Lush Ice (Watermelon Ice)<br>
          - Skittles Ice<br>
          - Guava Kiwi Passionfruit (sold out)<br>
          - Blue Razz (sold out)<br>
          - Grape Ice (sold out)<br>`,
          price: 35.00        
        },
        {
          id: 3,
          name: '5% nic OVNS Mesh20 ‚Äì 10,000 Puff Disposable Vape',
          image: 'ovnsMesh20s.png',
          type: 'hybrid',
          thc: '26%-28%',
          cbd: 0.1,
          flavour: 'Strawberry Watermelon',
          effects: '',
          desc: 'Puffs: Up to 10,000 <br>Capacity: 20mL <br>Battery: 600mAh <br><br>Available Flavours:<br>- Strawberry Watermelon',
          price: 45.00
        },
        {
          id: 4,
          name: 'Penis Envy Shrooms ‚Äì Potent Psilocybin Mushrooms',
          image: 'penisEnvy.png',
          type: 'indica',
          thc: 22,
          cbd: 0.2,
          flavour: 'Earthy, Pine',
          effects: 'Euphoric, Relaxed',
          desc: 'Penis Envy magic mushrooms are widely recognized as one of the most powerful psilocybin strains in the world. <br><br>Commonly known for their intense effects, unique appearance, and lasting impact.',
          price: 40.00
        },
        {
          id: 5,
          name: 'Blue Meaniez Shrooms ‚Äì Potent Psilocybin Mushrooms',
          image: 'bluemeaniez.png',
          type: 's',
          thc: 22,
          cbd: 0.2,
          flavour: 'Earthy, Pine',
          effects: 'Euphoric, Relaxed',
          desc: 'Blue Meaniez magic mushrooms are widely recognized as one of the most powerful psilocybin strains in the world. <br><br>Commonly known for their intense effects, unique appearance, and lasting impact.',
          price: 35.00
        },
        {
          id: 6,
          name: 'Blueberry Diesel Vape ‚Äì 1.1g THC Distillate Cart',
          image: 'blueberryDieselCart.png',
          type: 'sativa',
          thc: '88%',
          cbd: 0.05,
          flavour: 'Diesel, Citrus',
          effects: 'Energetic, Focused',
          desc: 'Sweet and pungent, Blueberry Diesel 1ml THC vape cart delivers potent effects, pure distillate, bold flavor, and smooth draws with 510-thread compatibility.<br><br>Better yet, we never use fillers or cutting agents. That means you‚Äôre getting pure THC oil and natural terpenes ‚Äî nothing more. As a result, each hit is clean, smooth, and consistently satisfying.',
          price: 35.00
        },
        {
          id: 7,
          name: 'Mango Kush Vape ‚Äì 1.1g THC Distillate Cart',
          image: 'mangoKushCart.png',
          type: 'indica',
          thc: '86%',
          cbd: 0.1,
          flavour: 'Sweet, Spicy',
          effects: 'Sleepy, Relaxed',
          desc: 'Discover the tropical taste of Mango Kush with this potent 1ml THC distillate vape cart. Premium quality, 510-thread compatible, and full of flavor.<br><br>If you‚Äôre looking for a flavorful and effective THC vape, look no further. Our Mango Kush Vape Cart ‚Äì 1ml THC Distillate Cart delivers a smooth, tropical experience that‚Äôs both relaxing and uplifting.',
          price: 35.00
        },
        {
          id: 8,
          name: 'Solei 510 Thread Battery ‚Äì Universal Vape Pen',
          image: '510battery.png',
          type: 'hybrid',
          thc: 'N/A',
          cbd: 'N/A',
          desc: 'Universal 510 thread battery compatible with all standard cartridges.',
          price: 20.00
        },
        {
          id: 9,
          name: 'Pre-rolls Grease Monkey Cannabis ‚Äì Organic Slow Burning Joints',
          image: 'prerolls.png',
          type: 'hybrid',
          thc: '26%-28%',
          cbd: 0.1,
          desc: 'Premium pre-rolled joints ready to enjoy.',
          price: 20.00
        },
        {
          id: 10,
          name: '100¬µg LSD Tabs ‚Äì Lab-Tested Psychedelic Blotters',
          image: 'vanCityAcid.png',
          type: 'sativa',
          thc: '26%-28%',
          cbd: 0.1,
          desc: 'Our 100¬µg LSD Tabs offer a consistent, lab-tested experience for those seeking deep introspection, creative enhancement, or therapeutic self-discovery.',
          price: 20.00
        },
        {
          id: 11,
          name: 'Cigarettes',
          image: 'bomboclat.png',
          type: 'sativa',
          thc: '26%-28%',
          cbd: 0.1,
          desc: 'Our 100¬µg LSD Tabs offer a consistent, lab-tested experience for those seeking deep introspection, creative enhancement, or therapeutic self-discovery.',
          price: 20.00
        }
      ];

      // Product catalog
      const products = [
        {
          id: 101,
          name: 'Premium Flower',
          image: 'product-tshirt.jpg',
          category: 'Flower',
          price: 10.99,
          grams: '3.5g',
          potency: '22% THC',
          desc: 'High-quality dried flower with excellent flavor profile.'
        },
        {
          id: 102,
          name: 'Concentrate Syringe',
          image: 'product-tray.jpg',
          category: 'Concentrate',
          price: 10.99,
          grams: '1g',
          potency: '85% THC',
          desc: 'Premium concentrate in easy-to-use syringe format.'
        },
        {
          id: 103,
          name: 'Edible Gummies',
          image: 'product-tea.jpg',
          category: 'Edibles',
          price: 10.99,
          grams: '10 pieces',
          potency: '10mg THC each',
          desc: 'Delicious, precisely dosed gummies for consistent effects.'
        },
        {
          id: 104,
          name: 'Pre-Rolled Joints',
          image: 'sample.png',
          category: 'Pre-Roll',
          price: 10.99,
          grams: '0.75g each',
          potency: '20% THC',
          desc: 'Hand-rolled with premium flower, ready to enjoy.'
        },
        {
          id: 105,
          name: 'Cartridge - Vape',
          image: 'sample.png',
          category: 'Vape',
          price: 10.99,
          grams: '0.5ml',
          potency: '80% THC',
          desc: 'Compatible with standard 510 thread batteries.'
        },
        {
          id: 106,
          name: 'Tincture Bottle',
          image: 'sample.png',
          category: 'Tincture',
          price: 10.99,
          grams: '30ml',
          potency: '500mg THC total',
          desc: 'Sublingual tincture for fast absorption and precise dosing.'
        }
      ];

      // ---------- DOM references ----------
      const catalog = document.getElementById('catalog');
      const search = document.getElementById('search');
      const viewFilter = document.getElementById('viewFilter');
      const typeFilter = document.getElementById('typeFilter');
      const thcFilter = document.getElementById('thcFilter');
      const reset = document.getElementById('reset');
      const toggleControls = document.getElementById('toggleControls');
      const controls = document.querySelector('.controls');
      const grid = document.getElementById('catalog');

      // Render a list of items into the catalog element
      function render(list) {
        catalog.innerHTML = '';

        if (!list.length) {
          catalog.innerHTML = '<p style="color:var(--muted)">No items match your filters.</p>';
          return;
        }

        list.forEach((s) => {
          const card = document.createElement('article');
          card.className = 'card';
          // Hide specific items by id ‚Äî keep this list centralized for clarity
          const hiddenIds = [ 3, 4, 5, 6, 7, 10, 11];
          if (hiddenIds.includes(s.id)) return;
          /*
            1 - Grease Monkey
            2 - Mesh10s
            3 - Mesh20s
            4 - Penis Envy
            5 - Blue Meanies
            6 - Blueberry Diesel
            7 - Mango Ass
            8 - Battery
            9 - Prerolls
            10 - tabs
            11 - cigs
          */
          if (s.kind === 'product') {
            // Product card layout (show sale price and struck original price)
            const salePrice = Number(s.price) || 10.99;
            const origPrice = (salePrice * 1.2).toFixed(2);
            card.innerHTML = `
              <div class="thumb"><img alt="${s.name} photo" src="images/${s.image}"></div>
              <h3 style="margin:0">${s.name}</h3>
              <div class="tags">
                <div class="pill">${s.category}</div>
                <div class="pill">${s.grams}</div>
                <div class="pill">${s.potency}</div>
              </div>
              <p style="margin:.6rem 0 .2rem;color:var(--muted);font-size:.95rem">${s.desc}</p>
              <div class="price"><small class="orig">$${origPrice}</small><span class="sale">$${salePrice.toFixed(2)}</span></div>
              <div class="meta"><button data-id="${s.id}">Details</button></div>
            `;
          } else { // if s kind === 'strain'
            // Strain card layout
            // Some strains provide THC/CBD with percent signs already; render raw value
            // Optionally hide pills for specific IDs (2 and 5)
            const hidePills = (s.id === 2 || s.id === 3 || s.id === 4 || s.id === 5 || s.id === 8 || s.id === 10 || s.id === 11);
            const tagsHtml = hidePills ? '' : `
                <div class="tags">
                  <div class="pill">${s.type.toUpperCase()}</div>
                  <div class="pill">THC: ${s.thc}</div>
                  <div class="pill">CBD: ${s.cbd}</div>
                </div>`;

            const salePrice = Number(s.price) || 10.99;
            const origPrice = (salePrice + 5.00).toFixed(2);
            card.innerHTML = `
              <div class="thumb"><img alt="${s.name} photo" src="images/${s.image}"></div>
              <h3 style="margin:0">${s.name}</h3>
              ${tagsHtml}
              <div class="price"><small class="orig">$${origPrice}</small><span class="sale">$${salePrice.toFixed(2)}</span></div>
              <div class="meta"><small>${s.desc}</small><button data-id="${s.id}">Details</button></div>
            `;
          }

          catalog.appendChild(card);
        });
      }

      // Apply filters and search to the combined pool and render results
      function applyFilters() {
        const q = search.value.trim().toLowerCase();
        const view = viewFilter.value;
        const type = typeFilter.value;
        const thc = thcFilter.value;

        let pool = [];
        if (view === 'strains') pool = strains.map((s) => ({ ...s, kind: 'strain' }));
        else if (view === 'products') pool = products.map((p) => ({ ...p, kind: 'product' }));
        else pool = strains.map((s) => ({ ...s, kind: 'strain' })).concat(products.map((p) => ({ ...p, kind: 'product' })));

        const out = pool.filter((item) => {
          // Hide products with IDs 101-106 (tiles 7+)
          if (item.id >= 101 && item.id <= 106) return false;

          if (item.kind === 'strain') {
            if (type !== 'all' && item.type !== type) return false;
            if (thc === 'low' && !(item.thc < 10)) return false;
            if (thc === 'med' && !(item.thc >= 10 && item.thc <= 20)) return false;
            if (thc === 'high' && !(item.thc > 20)) return false;
          }

          if (!q) return true;

          const hay = (
            (item.name || '') +
            ' ' +
            (item.desc || '') +
            ' ' +
            (item.flavour || '') +
            ' ' +
            (item.effects || '') +
            ' ' +
            (item.category || '') +
            ' ' +
            (item.price || '')
          ).toLowerCase();

          return hay.includes(q);
        });

        render(out);
      }

      // ---------- Events ----------
      // wire up filters and controls
      search.addEventListener('input', applyFilters);
      viewFilter.addEventListener('change', applyFilters);
      typeFilter.addEventListener('change', applyFilters);
      thcFilter.addEventListener('change', applyFilters);
      reset.addEventListener('click', () => {
        search.value = '';
        viewFilter.value = 'both';
        typeFilter.value = 'all';
        thcFilter.value = 'any';
        applyFilters();
      });
      
      // IG popup
      document.querySelector(".ig a").addEventListener("click", function (e) {
        e.preventDefault(); // stop redirect
        document.getElementById("igPopup").style.display = "flex";
      });

      document.querySelector(".ig-close").addEventListener("click", function () {
        document.getElementById("igPopup").style.display = "none";
      });

      // click outside to close
      document.getElementById("igPopup").addEventListener("click", function (e) {
        if (e.target === this) {
          this.style.display = "none";
        }
      });
  


      // toggle controls and grid visibility
      toggleControls.addEventListener('click', () => {
        const isShown = controls.classList.toggle('show');
        grid.classList.toggle('show');
        toggleControls.textContent = isShown ? 'Hide Controls' : 'Show Controls';
      });

      // details modal (works for strains and products)
      document.body.addEventListener('click', (e) => {
        const id = e.target.getAttribute('data-id');
        if (!id) return;

        let s = strains.find((x) => x.id == id);
        let kind = 'strain';
        if (!s) {
          s = products.find((x) => x.id == id);
          kind = 'product';
        }
        if (!s) return;

        if (kind === 'strain') {
          document.getElementById('m-title').textContent = s.name + ' ‚Äî ' + s.type.toUpperCase();
          document.getElementById('m-desc').textContent = s.desc;
          // Show raw THC/CBD values (don't append extra %)
          const salePrice = Number(s.price) || 10.99;
          const origPrice = (salePrice * 1.2).toFixed(2);
          document.getElementById('m-notes').textContent = `THC: ${s.thc} ¬∑ CBD: ${s.cbd} ¬∑ Price: $${salePrice.toFixed(2)} (was $${origPrice})`;
        } else {
          document.getElementById('m-title').textContent = s.name + ' ‚Äî ' + s.category;
          document.getElementById('m-desc').textContent = s.desc;
          const salePrice = Number(s.price) || 10.99;
          const origPrice = (salePrice * 1.2).toFixed(2);
          document.getElementById('m-notes').textContent = `Weight: ${s.grams} ¬∑ Potency: ${s.potency} ¬∑ Price: $${salePrice.toFixed(2)} (was $${origPrice})`;
        }

        document.getElementById('modal').style.display = 'flex';
      });

      document.getElementById('closeModal').addEventListener('click', () => document.getElementById('modal').style.display = 'none');

      // age gate: show overlay until user confirms they're 18+
      (function() {
        const AGE_KEY = 'topShelfAge';
        const gate = document.getElementById('ageGate');
        const yes = document.getElementById('ageYes');
        const no = document.getElementById('ageNo');

        function show() {
          if (!gate) return;
          gate.style.display = 'flex';
          gate.setAttribute('aria-hidden', 'false');
        }

        function hide() {
          if (!gate) return;
          gate.style.display = 'none';
          gate.setAttribute('aria-hidden', 'true');
        }

        // If already verified, hide the gate
        if (localStorage.getItem(AGE_KEY) === 'true') {
          hide();
        } else {
          show();
        }

        if (yes) {
          yes.addEventListener('click', function () {
            localStorage.setItem(AGE_KEY, 'true');
            hide();
          });
        }

        if (no) {
          no.addEventListener('click', function () {
            // If user declines, send them away
            window.location.href = 'https://www.google.com';
          });
        }
      })();
      // reCAPTCHA verification
      window.onRecaptchaSuccess = function() {
        localStorage.setItem('recaptchaVerified', 'true');
        document.getElementById('recaptchaOverlay').classList.add('hidden');
      };

      // Check if reCAPTCHA is already verified
      if (localStorage.getItem('recaptchaVerified') === 'true') {
        document.getElementById('recaptchaOverlay').classList.add('hidden');
      }

      // initial render
      applyFilters();
    </script>
  </body>
</html>